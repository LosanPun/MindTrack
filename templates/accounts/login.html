{% extends 'base.html' %}
{% load static %}

{% block title %}Login - MindTrack{% endblock %}

{% block body_class %}auth-page{% endblock %}

{% block content %}
<div class="background-side left-side"></div>
<div class="background-side right-side"></div>

<div class="container" id="container">
    <!-- Sign In Form -->
    <div class="form-container sign-in-container">
        <form method="POST" action="{% url 'login' %}" id="signInForm">
            {% csrf_token %}
            
            <div class="form-header">
                <h1>Sign In to MindTrack</h1>
                <p>Track your moods, understand your emotions</p>
            </div>
            
            <!-- Google Login Only -->
            <div class="social-auth">
                <a href="#" class="social-btn google" aria-label="Sign in with Google" onclick="alert('Google OAuth will be implemented soon!')">
                    <i class="fab fa-google"></i>
                    <span>Sign in with Google</span>
                </a>
            </div>
            
            <div class="divider">
                <span>or use your email</span>
            </div>
            
            <!-- Display Django messages -->
            {% if messages %}
            <div class="messages">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Django Form Errors -->
            {% if form.errors %}
            <div class="alert alert-error">
                <p>Please correct the errors below:</p>
                <ul>
                    {% for field, errors in form.errors.items %}
                        {% for error in errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Email Field -->
            <div class="form-group">
                <label for="id_username">Email Address</label>
                <div class="input-with-icon">
                    <i class="fas fa-envelope"></i>
                    <input type="email" 
                           id="id_username" 
                           name="username" 
                           class="form-control" 
                           placeholder="Enter your email" 
                           required
                           value="{{ form.username.value|default:'' }}">
                </div>
                {% if form.username.errors %}
                <span class="error-message">{{ form.username.errors.0 }}</span>
                {% endif %}
            </div>
            
            <!-- Password Field -->
            <div class="form-group">
                <label for="id_password">Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" 
                           id="id_password" 
                           name="password" 
                           class="form-control" 
                           placeholder="Enter your password" 
                           required>
                    <button type="button" class="password-toggle" id="toggleSignInPassword">
                        <i class="far fa-eye"></i>
                    </button>
                </div>
                {% if form.password.errors %}
                <span class="error-message">{{ form.password.errors.0 }}</span>
                {% endif %}
            </div>
            
            <div class="form-options">
                <label class="remember-me">
                    <input type="checkbox" id="rememberMe" name="remember_me">
                    <span>Remember me</span>
                </label>
                <a href="{% url 'password_reset' %}" class="forgot-password">Forgot password?</a>
            </div>
            
            <button type="submit" class="btn btn-primary">Sign In</button>
            
            <div class="form-footer">
                <p>Don't have an account? <a href="#" id="showSignUp">Sign Up</a></p>
                <p><a href="{% url 'home' %}">← Back to Home</a></p>
            </div>
        </form>
    </div>
    
    <!-- Sign Up Form -->
    <div class="form-container sign-up-container">
        <form method="POST" action="{% url 'register' %}" id="signUpForm">
            {% csrf_token %}
            
            <div class="form-header">
                <h1>Join MindTrack</h1>
                <p>Start your journey to emotional awareness</p>
            </div>
            
            <!-- Google Sign Up Only -->
            <div class="social-auth">
                <a href="#" class="social-btn google" aria-label="Sign up with Google" onclick="alert('Google OAuth will be implemented soon!')">
                    <i class="fab fa-google"></i>
                    <span>Sign up with Google</span>
                </a>
            </div>
            
            <div class="divider">
                <span>or use your email</span>
            </div>
            
            <!-- Display registration errors -->
            {% if registration_form.errors %}
            <div class="alert alert-error">
                <p>Please correct the errors below:</p>
                <ul>
                    {% for field, errors in registration_form.errors.items %}
                        {% for error in errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            
            <!-- Email Field -->
            <div class="form-group">
                <label for="id_email">Email Address</label>
                <div class="input-with-icon">
                    <i class="fas fa-envelope"></i>
                    <input type="email" 
                           id="id_email" 
                           name="email" 
                           class="form-control" 
                           placeholder="Enter your email" 
                           required
                           value="{{ registration_form.email.value|default:'' }}">
                </div>
                {% if registration_form.email.errors %}
                <span class="error-message">{{ registration_form.email.errors.0 }}</span>
                {% endif %}
            </div>
            
            <!-- Password Field -->
            <div class="form-group">
                <label for="id_password1">Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" 
                           id="id_password1" 
                           name="password1" 
                           class="form-control" 
                           placeholder="Create a password" 
                           required>
                    <button type="button" class="password-toggle" id="toggleSignUpPassword">
                        <i class="far fa-eye"></i>
                    </button>
                </div>
                <div class="password-strength" id="passwordStrength">
                    <div class="strength-bar"></div>
                    <span class="strength-text">Password strength</span>
                </div>
                {% if registration_form.password1.errors %}
                <span class="error-message">{{ registration_form.password1.errors.0 }}</span>
                {% endif %}
            </div>
            
            <!-- Confirm Password Field -->
            <div class="form-group">
                <label for="id_password2">Confirm Password</label>
                <div class="input-with-icon">
                    <i class="fas fa-lock"></i>
                    <input type="password" 
                           id="id_password2" 
                           name="password2" 
                           class="form-control" 
                           placeholder="Confirm your password" 
                           required>
                    <button type="button" class="password-toggle" id="toggleConfirmPassword">
                        <i class="far fa-eye"></i>
                    </button>
                </div>
                {% if registration_form.password2.errors %}
                <span class="error-message">{{ registration_form.password2.errors.0 }}</span>
                {% endif %}
            </div>
            
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="agreeTerms" name="agree_terms" required>
                    <span>I agree to the <a href="#" onclick="showTerms(); return false;">Terms of Service</a> and <a href="#" onclick="showPrivacy(); return false;">Privacy Policy</a></span>
                </label>
            </div>
            
            <button type="submit" class="btn btn-primary">Create Account</button>
            
            <div class="form-footer">
                <p>Already have an account? <a href="#" id="showSignIn">Sign In</a></p>
                <p><a href="{% url 'home' %}">← Back to Home</a></p>
            </div>
        </form>
    </div>
    
    <!-- Overlay Panels -->
    <div class="overlay-container">
        <div class="overlay">
            <div class="overlay-panel overlay-left">
                <div class="overlay-content">
                    <h1>Welcome Back!</h1>
                    <p>Track your emotional journey with us</p>
                    <button class="btn btn-outline" id="signInOverlay">Sign In</button>
                </div>
            </div>
            <div class="overlay-panel overlay-right">
                <div class="overlay-content">
                    <h1>Hello, Friend!</h1>
                    <p>Start your emotional awareness journey today</p>
                    <button class="btn btn-outline" id="signUpOverlay">Sign Up</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Your original JavaScript with Django integration
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.getElementById('container');
        const showSignUp = document.getElementById('showSignUp');
        const showSignIn = document.getElementById('showSignIn');
        const signInOverlay = document.getElementById('signInOverlay');
        const signUpOverlay = document.getElementById('signUpOverlay');
        
        // Toggle between Sign In and Sign Up
        if (showSignUp) {
            showSignUp.addEventListener('click', (e) => {
                e.preventDefault();
                container.classList.add('right-panel-active');
            });
        }
        
        if (showSignIn) {
            showSignIn.addEventListener('click', (e) => {
                e.preventDefault();
                container.classList.remove('right-panel-active');
            });
        }
        
        if (signInOverlay) {
            signInOverlay.addEventListener('click', (e) => {
                e.preventDefault();
                container.classList.remove('right-panel-active');
            });
        }
        
        if (signUpOverlay) {
            signUpOverlay.addEventListener('click', (e) => {
                e.preventDefault();
                container.classList.add('right-panel-active');
            });
        }
        
        // Password toggle functionality
        const toggleSignInPassword = document.getElementById('toggleSignInPassword');
        const toggleSignUpPassword = document.getElementById('toggleSignUpPassword');
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const signInPassword = document.getElementById('id_password');
        const signUpPassword = document.getElementById('id_password1');
        const confirmPassword = document.getElementById('id_password2');
        
        function togglePasswordVisibility(passwordField, toggleButton) {
            const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordField.setAttribute('type', type);
            
            const icon = toggleButton.querySelector('i');
            if (type === 'text') {
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        if (toggleSignInPassword) {
            toggleSignInPassword.addEventListener('click', function() {
                togglePasswordVisibility(signInPassword, this);
            });
        }
        
        if (toggleSignUpPassword) {
            toggleSignUpPassword.addEventListener('click', function() {
                togglePasswordVisibility(signUpPassword, this);
            });
        }
        
        if (toggleConfirmPassword) {
            toggleConfirmPassword.addEventListener('click', function() {
                togglePasswordVisibility(confirmPassword, this);
            });
        }
        
        // Password strength indicator
        const passwordStrength = document.getElementById('passwordStrength');
        if (signUpPassword && passwordStrength) {
            signUpPassword.addEventListener('input', function() {
                checkPasswordStrength(this.value);
            });
        }
        
        function checkPasswordStrength(password) {
            let strength = 0;
            
            if (password.length >= 6) strength++;
            if (password.match(/[a-z]+/)) strength++;
            if (password.match(/[A-Z]+/)) strength++;
            if (password.match(/[0-9]+/)) strength++;
            if (password.match(/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/)) strength++;
            
            passwordStrength.className = 'password-strength';
            
            if (password.length === 0) {
                return;
            }
            
            if (strength < 2) {
                passwordStrength.classList.add('password-weak');
            } else if (strength < 4) {
                passwordStrength.classList.add('password-medium');
            } else {
                passwordStrength.classList.add('password-strong');
            }
        }
    });
    
    // Terms and Privacy functions
    function showTerms() {
        alert('MindTrack Terms of Service:\n\n1. Free tier includes 3 lifetime mood analyses\n2. Data automatically deleted after 1 week\n3. Premium features require subscription\n4. No refunds for monthly subscriptions\n5. Service may be discontinued at any time (college project)');
        return false;
    }
    
    function showPrivacy() {
        alert('MindTrack Privacy Policy:\n\n1. Your mood data is confidential\n2. No data sharing with third parties\n3. Email used only for account purposes\n4. Data encrypted in database\n5. You can delete your account anytime');
        return false;
    }
</script>
{% endblock %}