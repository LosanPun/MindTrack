{% extends 'base.html' %}

{% block title %}Mood Analytics - MindTrack{% endblock %}

{% block content %}
<div class="analytics-container">
    <!-- Header -->
    <div class="analytics-header">
        <div class="header-content">
            <h1><i class="fas fa-chart-line"></i> Mood Analytics</h1>
            <p>Track your emotional patterns and mood trends over time</p>
        </div>
        <div class="header-actions">
            <a href="{% url 'dashboard' %}" class="btn-back">
                <i class="fas fa-arrow-left"></i> Back to Dashboard
            </a>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-overview">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-brain"></i>
            </div>
            <div class="stat-info">
                <h3>Total Analyses</h3>
                <p class="stat-value">{{ pie_data|length }}</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-info">
                <h3>Days Tracked</h3>
                <p class="stat-value">{{ trend_labels|length }}</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-chart-pie"></i>
            </div>
            <div class="stat-info">
                <h3>Mood Types</h3>
                <p class="stat-value">{{ pie_labels|length }}</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-trending-up"></i>
            </div>
            <div class="stat-info">
                <h3>Insights</h3>
                <p class="stat-value">Available</p>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
        <div class="row">
            <!-- Pie Chart for Mood Distribution -->
            <div class="col-lg-6 col-md-12">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-pie"></i> Mood Distribution</h3>
                        <p>Overall breakdown of your mood patterns</p>
                    </div>
                    <div class="chart-body">
                        {% if pie_data %}
                        <canvas id="moodPieChart" height="300"
                                data-labels="{{ pie_labels|escapejs }}"
                                data-data="{{ pie_data|escapejs }}"></canvas>
                        {% else %}
                        <div class="empty-chart">
                            <div class="empty-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <h4>No Data Yet</h4>
                            <p>Start analyzing your mood to see your distribution here</p>
                            <a href="{% url 'dashboard' %}" class="btn-primary">Analyze Mood</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Line Chart for Trends -->
            <div class="col-lg-6 col-md-12">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Mood Trends</h3>
                        <p>Daily mood changes over the last 30 days</p>
                    </div>
                    <div class="chart-body">
                        {% if trend_datasets %}
                        <canvas id="moodTrendChart" height="300"></canvas>
                        {% else %}
                        <div class="empty-chart">
                            <div class="empty-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h4>No Trend Data</h4>
                            <p>Save more analyses to see your mood trends over time</p>
                            <a href="{% url 'dashboard' %}" class="btn-primary">Start Tracking</a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Insights Section -->
    {% if pie_labels %}
    <div class="insights-section">
        <h3><i class="fas fa-lightbulb"></i> Key Insights</h3>
        <div class="insights-grid">
            {% if pie_labels %}
            <div class="insight-card">
                <h4>Most Common Mood</h4>
                <p class="insight-value">{{ pie_labels.0|default:"--" }}</p>
                <p class="insight-desc">Your predominant emotional state</p>
            </div>
            {% endif %}
            <div class="insight-card">
                <h4>Mood Variety</h4>
                <p class="insight-value">{{ pie_labels|length }} types</p>
                <p class="insight-desc">Different moods you've experienced</p>
            </div>
            <div class="insight-card">
                <h4>Tracking Period</h4>
                <p class="insight-value">{{ trend_labels|length }} days</p>
                <p class="insight-desc">Days of mood tracking</p>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Pie Chart
    const pieCtx = document.getElementById('moodPieChart');
    if (pieCtx) {
        try {
            const pieLabels = JSON.parse('{{ pie_labels|escapejs }}');
            const pieData = JSON.parse('{{ pie_data|escapejs }}');

            if (pieData && pieData.length > 0) {
                new Chart(pieCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: pieLabels,
                        datasets: [{
                            data: pieData,
                            backgroundColor: [
                                '#FFD700', // happy
                                '#4169E1', // sad
                                '#DC143C', // angry
                                '#8A2BE2', // fear
                                '#808080', // neutral
                                '#FF69B4'  // surprise
                            ],
                            borderWidth: 2,
                            borderColor: '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                                        return label + ': ' + value + ' (' + percentage + '%)';
                                    }
                                }
                            }
                        }
                    }
                });
            }
        } catch (e) {
            console.error('Error creating pie chart:', e);
        }
    }

    // Line Chart
    const trendCtx = document.getElementById('moodTrendChart');
    if (trendCtx) {
        try {
            const trendLabels = JSON.parse('{{ trend_labels|escapejs }}');
            const trendDatasets = JSON.parse('{{ trend_datasets|escapejs }}');

            if (trendDatasets && trendDatasets.length > 0) {
                new Chart(trendCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: trendLabels,
                        datasets: trendDatasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        scales: {
                            x: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Date'
                                }
                            },
                            y: {
                                display: true,
                                title: {
                                    display: true,
                                    text: 'Number of Analyses'
                                },
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        }
                    }
                });
            }
        } catch (e) {
            console.error('Error creating trend chart:', e);
        }
    }
});
</script>

<style>
.analytics-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
}

.analytics-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    padding: 30px;
    background: linear-gradient(135deg, #0a1931, #1a2c4d);
    border-radius: 16px;
    color: white;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.header-content h1 {
    font-size: 32px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.header-content p {
    opacity: 0.9;
    font-size: 16px;
}

.btn-back {
    background: rgba(255, 255, 255, 0.1);
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-back:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateX(-2px);
}

.stats-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    display: flex;
    align-items: center;
    gap: 20px;
    transition: transform 0.3s;
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #d4af37, #f4e4a6);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #0a1931;
    font-size: 24px;
}

.stat-info h3 {
    font-size: 14px;
    color: #718096;
    margin-bottom: 8px;
}

.stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #0a1931;
}

.charts-section {
    margin-bottom: 40px;
}

.chart-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    height: 100%;
}

.chart-header {
    padding: 25px 30px;
    background: linear-gradient(135deg, #f8fafc, #e2e8f0);
    border-bottom: 1px solid #e2e8f0;
}

.chart-header h3 {
    font-size: 20px;
    margin-bottom: 5px;
    color: #0a1931;
    display: flex;
    align-items: center;
    gap: 10px;
}

.chart-header p {
    color: #718096;
    margin: 0;
}

.chart-body {
    padding: 30px;
    min-height: 350px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.empty-chart {
    text-align: center;
    color: #a0aec0;
}

.empty-icon {
    font-size: 64px;
    margin-bottom: 20px;
    opacity: 0.5;
}

.empty-chart h4 {
    font-size: 24px;
    margin-bottom: 10px;
    color: #4a5568;
}

.empty-chart p {
    margin-bottom: 20px;
}

.btn-primary {
    background: linear-gradient(135deg, #d4af37, #f4e4a6);
    color: #0a1931;
    padding: 12px 24px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s;
    display: inline-block;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(212, 175, 55, 0.3);
}

.insights-section {
    background: white;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.insights-section h3 {
    font-size: 24px;
    margin-bottom: 25px;
    color: #0a1931;
    display: flex;
    align-items: center;
    gap: 10px;
}

.insights-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.insight-card {
    background: #f8fafc;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    border: 1px solid #e2e8f0;
}

.insight-card h4 {
    font-size: 16px;
    color: #4a5568;
    margin-bottom: 10px;
}

.insight-value {
    font-size: 32px;
    font-weight: 700;
    color: #0a1931;
    margin-bottom: 5px;
}

.insight-desc {
    font-size: 14px;
    color: #718096;
    margin: 0;
}

@media (max-width: 768px) {
    .analytics-header {
        flex-direction: column;
        text-align: center;
        gap: 20px;
    }

    .stats-overview {
        grid-template-columns: repeat(2, 1fr);
    }

    .charts-section .row {
        gap: 20px;
    }

    .insights-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .stats-overview {
        grid-template-columns: 1fr;
    }

    .analytics-container {
        padding: 15px;
    }

    .chart-body {
        padding: 20px;
    }
}
</style>
{% endblock %}
